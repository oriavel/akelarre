<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Cueva</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 670,
        height: 630,
        physics: {
            default: 'arcade',
            arcade: {
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };


    var game = new Phaser.Game(config);
    var player;
    var animation;

    function preload (){
        //Cargar cueva:
        this.load.image('tiles', 'assets/Caves.png')
		this.load.tilemapTiledJSON('tilemap', 'assets/Cueva.json')

        //Cargar prota
        this.load.spritesheet('amaia', 
            'assets/Personajes/Prota.PNG',
            { frameWidth: 34, frameHeight: 34 }
        );
    }

    function create (){
        

        //Cueva
        const map = this.make.tilemap({ key: 'tilemap' })
		const tileset = map.addTilesetImage('PatronCueva', 'tiles')
		
		map.createStaticLayer('suelo', tileset)
        var layer = map.createStaticLayer('obstaculos', tileset)

        layer.setCollisionByExclusion([-1]);

        //Prota
        player = this.physics.add.sprite(200, 350, 'amaia').setScale(1.6);
        player.setSize(20, 13);
        this.physics.add.collider(player, layer);

        this.anims.create({
            key: 'right_amaia',
            frames: this.anims.generateFrameNumbers('amaia', { start: 12, end: 15 }),
            frameRate: 4,
            repeat: -1
        });

        this.anims.create({
            key: 'stop_right_amaia',
            frames: this.anims.generateFrameNumbers('amaia', { start: 15, end: 15 }),
            frameRate: 3,
            repeat: -1
        });

        this.anims.create({
            key: 'left_amaia',
            frames: this.anims.generateFrameNumbers('amaia', { start: 8, end: 11 }),
            frameRate: 4,
            repeat: -1
        });

        this.anims.create({
            key: 'stop_left_amaia',
            frames: this.anims.generateFrameNumbers('amaia', { start: 11, end: 11 }),
            frameRate: 4,
            repeat: -1
        });

        this.anims.create({
            key: 'up_amaia',
            frames: this.anims.generateFrameNumbers('amaia', { start: 4, end: 7 }),
            frameRate: 4,
            repeat: -1
        });

        this.anims.create({
            key: 'stop_up_amaia',
            frames: this.anims.generateFrameNumbers('amaia', { start: 7, end: 7 }),
            frameRate: 4,
            repeat: -1
        });

        this.anims.create({
            key: 'down_amaia',
            frames: this.anims.generateFrameNumbers('amaia', { start: 0, end: 3 }),
            frameRate: 4,
            repeat: -1
        });

        this.anims.create({
            key: 'stop_down_amaia',
            frames: this.anims.generateFrameNumbers('amaia', { start: 3, end: 3 }),
            frameRate: 4,
            repeat: -1
        });

        cursors = this.input.keyboard.createCursorKeys();

        player.setCollideWorldBounds(true);
    }

    function update (){
        if (cursors.right.isDown){
            player.setVelocityX(100);
            player.anims.play('right_amaia', true);
            animation = 1;

        }
        else if (cursors.left.isDown){
            player.setVelocityX(-100);
            player.anims.play('left_amaia', true);
            animation = 2;

        }
        else if (cursors.up.isDown){
            player.setVelocityY(-100);
            player.anims.play('up_amaia', true);
            animation = 3;
    
        }
        else if (cursors.down.isDown){
            player.setVelocityY(100);
            player.anims.play('down_amaia', true);
            animation = 4;
            
            
        }
        else{
            player.setVelocityX(0);
            player.setVelocityY(0);

            if(animation == 1)
                player.anims.play('stop_right_amaia', true);

            else if(animation == 2){
                player.anims.play('stop_left_amaia', true);
            }
            else if(animation == 3){
                player.anims.play('stop_up_amaia', true);
            }
            else if(animation == 4){
                player.anims.play('stop_down_amaia', true);
            }
        }
    }


</script>

</body>
</html>